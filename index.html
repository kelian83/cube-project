<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Severance x Bang & Olufsen - WebXR Experience</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <a-scene 
      vr-mode-ui="enabled: true"
      webxr="requiredFeatures: hit-test,local-floor; optionalFeatures: hand-tracking"
      renderer="colorManagement: true; physicallyCorrectLights: true"
      background="color: #000000"
      fog="type: exponential; color: #000000; density: 0"
      state-manager
    >
      <!-- ============================================ -->
      <!-- ASSETS -->
      <!-- ============================================ -->
      <a-assets>
        <audio id="plug-sound" src="https://cdn.freesound.org/previews/256/256113_3263906-lq.mp3" preload="auto"></audio>
        <audio id="success-sound" src="https://cdn.freesound.org/previews/341/341695_5858296-lq.mp3" preload="auto"></audio>
      </a-assets>

      <!-- ============================================ -->
      <!-- ENVIRONNEMENT - Architecture Severance -->
      <!-- ============================================ -->
      
      <!-- Vide Noir Infini (Skybox sombre) -->
      <a-sky color="#000000"></a-sky>

      <!-- Plateforme - Sol Moquette Vert Sauge -->
      <a-plane
        id="floor"
        position="0 0 0"
        rotation="-90 0 0"
        width="4"
        height="4"
        material="color: #7DA17E; roughness: 0.9; metalness: 0"
      ></a-plane>

      <!-- Mur Gauche - Blanc Laqué -->
      <a-plane
        id="wall-left"
        position="-2 1.5 0"
        rotation="0 90 0"
        width="4"
        height="3"
        material="color: #FFFFFF; roughness: 0.1; metalness: 0.1"
      ></a-plane>

      <!-- Mur Droit - Blanc Laqué -->
      <a-plane
        id="wall-right"
        position="2 1.5 0"
        rotation="0 -90 0"
        width="4"
        height="3"
        material="color: #FFFFFF; roughness: 0.1; metalness: 0.1"
      ></a-plane>

      <!-- Mur Fond - Blanc Laqué -->
      <a-plane
        id="wall-back"
        position="0 1.5 -2"
        rotation="0 0 0"
        width="4"
        height="3"
        material="color: #FFFFFF; roughness: 0.1; metalness: 0.1"
      ></a-plane>

      <!-- ============================================ -->
      <!-- PLAFOND - Grille de Dalles Lumineuses -->
      <!-- ============================================ -->
      <a-entity id="ceiling-lights" position="0 2.9 0">
        <!-- Rangée 1 -->
        <a-box class="ceiling-light" position="-1.2 0 -1.2" width="0.8" height="0.05" depth="0.8" 
               material="color: #FFFFFF; emissive: #FFFFFF; emissiveIntensity: 0.8"></a-box>
        <a-box class="ceiling-light" position="0 0 -1.2" width="0.8" height="0.05" depth="0.8" 
               material="color: #FFFFFF; emissive: #FFFFFF; emissiveIntensity: 0.8"></a-box>
        <a-box class="ceiling-light" position="1.2 0 -1.2" width="0.8" height="0.05" depth="0.8" 
               material="color: #FFFFFF; emissive: #FFFFFF; emissiveIntensity: 0.8"></a-box>
        <!-- Rangée 2 -->
        <a-box class="ceiling-light" position="-1.2 0 0" width="0.8" height="0.05" depth="0.8" 
               material="color: #FFFFFF; emissive: #FFFFFF; emissiveIntensity: 0.8"></a-box>
        <a-box class="ceiling-light" position="0 0 0" width="0.8" height="0.05" depth="0.8" 
               material="color: #FFFFFF; emissive: #FFFFFF; emissiveIntensity: 0.8"></a-box>
        <a-box class="ceiling-light" position="1.2 0 0" width="0.8" height="0.05" depth="0.8" 
               material="color: #FFFFFF; emissive: #FFFFFF; emissiveIntensity: 0.8"></a-box>
        <!-- Rangée 3 -->
        <a-box class="ceiling-light" position="-1.2 0 1.2" width="0.8" height="0.05" depth="0.8" 
               material="color: #FFFFFF; emissive: #FFFFFF; emissiveIntensity: 0.8"></a-box>
        <a-box class="ceiling-light" position="0 0 1.2" width="0.8" height="0.05" depth="0.8" 
               material="color: #FFFFFF; emissive: #FFFFFF; emissiveIntensity: 0.8"></a-box>
        <a-box class="ceiling-light" position="1.2 0 1.2" width="0.8" height="0.05" depth="0.8" 
               material="color: #FFFFFF; emissive: #FFFFFF; emissiveIntensity: 0.8"></a-box>
      </a-entity>

      <!-- Lumières RGB pour Party Mode (désactivées au départ) -->
      <a-entity id="disco-lights" visible="false">
        <a-light id="disco-light-1" type="spot" color="#0000FF" intensity="0" position="-1 2.5 -1" 
                 target="#floor" angle="45" penumbra="0.5"
                 animation__rotate="property: rotation; to: 0 360 0; dur: 4000; loop: true; easing: linear; pauseEvents: pauseAnimation; resumeEvents: resumeAnimation"></a-light>
        <a-light id="disco-light-2" type="spot" color="#8B00FF" intensity="0" position="1 2.5 -1" 
                 target="#floor" angle="45" penumbra="0.5"
                 animation__rotate="property: rotation; to: 0 -360 0; dur: 3000; loop: true; easing: linear; pauseEvents: pauseAnimation; resumeEvents: resumeAnimation"></a-light>
        <a-light id="disco-light-3" type="spot" color="#FF00FF" intensity="0" position="0 2.5 1" 
                 target="#floor" angle="45" penumbra="0.5"
                 animation__rotate="property: rotation; to: 360 0 0; dur: 5000; loop: true; easing: linear; pauseEvents: pauseAnimation; resumeEvents: resumeAnimation"></a-light>
      </a-entity>

      <!-- Éclairage ambiant -->
      <a-light type="ambient" color="#404040" intensity="0.3"></a-light>
      <a-light type="directional" position="0 3 1" intensity="0.5" color="#FFFFFF"></a-light>

      <!-- ============================================ -->
      <!-- BUREAU -->
      <!-- ============================================ -->
      <a-entity id="desk" position="0 0 -0.8">
        <!-- Plateau -->
        <a-box position="0 0.75 0" width="1.2" height="0.05" depth="0.6" 
               material="color: #2C2C2C; roughness: 0.3; metalness: 0.2"></a-box>
        <!-- Pieds -->
        <a-box position="-0.5 0.375 0.2" width="0.05" height="0.75" depth="0.05" 
               material="color: #1A1A1A"></a-box>
        <a-box position="0.5 0.375 0.2" width="0.05" height="0.75" depth="0.05" 
               material="color: #1A1A1A"></a-box>
        <a-box position="-0.5 0.375 -0.2" width="0.05" height="0.75" depth="0.05" 
               material="color: #1A1A1A"></a-box>
        <a-box position="0.5 0.375 -0.2" width="0.05" height="0.75" depth="0.05" 
               material="color: #1A1A1A"></a-box>
      </a-entity>

      <!-- ============================================ -->
      <!-- CONSOLE BANG & OLUFSEN -->
      <!-- ============================================ -->
      <a-entity id="bo-console" position="0 0.82 -0.8">
        <!-- Boîtier Principal Alu -->
        <a-box position="0 0.05 0" width="0.4" height="0.1" depth="0.15" 
               material="color: #C0C0C0; roughness: 0.2; metalness: 0.8"></a-box>
        
        <!-- Port 1 -->
        <a-entity id="port-1" class="cable-port" position="-0.12 0.05 0.08" cable-port="portId: 1">
          <a-cylinder rotation="90 0 0" radius="0.015" height="0.02" 
                      material="color: #1A1A1A; metalness: 0.9"></a-cylinder>
          <a-ring id="ring-1" class="port-ring" rotation="90 0 0" radius-inner="0.012" radius-outer="0.018" 
                  material="color: #FF0000; emissive: #FF0000; emissiveIntensity: 0.8; side: double"></a-ring>
        </a-entity>
        
        <!-- Port 2 -->
        <a-entity id="port-2" class="cable-port" position="-0.04 0.05 0.08" cable-port="portId: 2">
          <a-cylinder rotation="90 0 0" radius="0.015" height="0.02" 
                      material="color: #1A1A1A; metalness: 0.9"></a-cylinder>
          <a-ring id="ring-2" class="port-ring" rotation="90 0 0" radius-inner="0.012" radius-outer="0.018" 
                  material="color: #FF0000; emissive: #FF0000; emissiveIntensity: 0.8; side: double"></a-ring>
        </a-entity>
        
        <!-- Port 3 -->
        <a-entity id="port-3" class="cable-port" position="0.04 0.05 0.08" cable-port="portId: 3">
          <a-cylinder rotation="90 0 0" radius="0.015" height="0.02" 
                      material="color: #1A1A1A; metalness: 0.9"></a-cylinder>
          <a-ring id="ring-3" class="port-ring" rotation="90 0 0" radius-inner="0.012" radius-outer="0.018" 
                  material="color: #FF0000; emissive: #FF0000; emissiveIntensity: 0.8; side: double"></a-ring>
        </a-entity>
        
        <!-- Port 4 -->
        <a-entity id="port-4" class="cable-port" position="0.12 0.05 0.08" cable-port="portId: 4">
          <a-cylinder rotation="90 0 0" radius="0.015" height="0.02" 
                      material="color: #1A1A1A; metalness: 0.9"></a-cylinder>
          <a-ring id="ring-4" class="port-ring" rotation="90 0 0" radius-inner="0.012" radius-outer="0.018" 
                  material="color: #FF0000; emissive: #FF0000; emissiveIntensity: 0.8; side: double"></a-ring>
        </a-entity>
      </a-entity>

      <!-- ============================================ -->
      <!-- CÂBLES (Pendants du Plafond) -->
      <!-- ============================================ -->
      <a-entity id="cables-container">
        <!-- Câble 1 -->
        <a-entity id="cable-1" class="cable" cable-system="cableId: 1; startPos: -0.12 2.8 -0.8; color: #3498db">
        </a-entity>
        
        <!-- Câble 2 -->
        <a-entity id="cable-2" class="cable" cable-system="cableId: 2; startPos: -0.04 2.8 -0.8; color: #e74c3c">
        </a-entity>
        
        <!-- Câble 3 -->
        <a-entity id="cable-3" class="cable" cable-system="cableId: 3; startPos: 0.04 2.8 -0.8; color: #2ecc71">
        </a-entity>
        
        <!-- Câble 4 -->
        <a-entity id="cable-4" class="cable" cable-system="cableId: 4; startPos: 0.12 2.8 -0.8; color: #f39c12">
        </a-entity>
      </a-entity>

      <!-- ============================================ -->
      <!-- ENCEINTES (Placeholders pour Party Mode) -->
      <!-- ============================================ -->
      <a-entity id="speaker-left" class="speaker" position="-1.8 0.5 -1" 
                geometry="primitive: box; width: 0.3; height: 0.6; depth: 0.25"
                material="color: #1A1A1A; roughness: 0.3; metalness: 0.5">
      </a-entity>
      <a-entity id="speaker-right" class="speaker" position="1.8 0.5 -1" 
                geometry="primitive: box; width: 0.3; height: 0.6; depth: 0.25"
                material="color: #1A1A1A; roughness: 0.3; metalness: 0.5">
      </a-entity>

      <!-- ============================================ -->
      <!-- PLAYER RIG (Quest 3 Optimisé) -->
      <!-- ============================================ -->
      <a-entity id="rig" position="0 0 1.5">
        <!-- Caméra -->
        <a-camera 
          id="camera"
          position="0 1.6 0"
          look-controls="pointerLockEnabled: false"
          wasd-controls="enabled: true"
        ></a-camera>

        <!-- Main Gauche -->
        <a-entity 
          id="left-hand"
          oculus-touch-controls="hand: left"
          vr-hand-controls="hand: left"
          raycaster="objects: .cable-tip; far: 0.1; showLine: false"
        >
          <!-- Collider sphérique pour proximité -->
          <a-sphere 
            class="hand-collider"
            radius="0.03"
            visible="false"
            position="0 0 -0.05"
          ></a-sphere>
        </a-entity>

        <!-- Main Droite -->
        <a-entity 
          id="right-hand"
          oculus-touch-controls="hand: right"
          vr-hand-controls="hand: right"
          raycaster="objects: .cable-tip; far: 0.1; showLine: false"
        >
          <!-- Collider sphérique pour proximité -->
          <a-sphere 
            class="hand-collider"
            radius="0.03"
            visible="false"
            position="0 0 -0.05"
          ></a-sphere>
        </a-entity>
      </a-entity>

    </a-scene>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
